for(var e,t={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},n=new Uint8Array(16),r=[],i=0;i<256;++i)r.push((i+256).toString(16).slice(1));var s=function(i,s,o){if(t.randomUUID&&!s&&!i)return t.randomUUID();var a=(i=i||{}).random||(i.rng||function(){if(!e&&!(e="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return e(n)})();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,s){o=o||0;for(var h=0;h<16;++h)s[o+h]=a[h];return s}return function(e,t=0){return(r[e[t+0]]+r[e[t+1]]+r[e[t+2]]+r[e[t+3]]+"-"+r[e[t+4]]+r[e[t+5]]+"-"+r[e[t+6]]+r[e[t+7]]+"-"+r[e[t+8]]+r[e[t+9]]+"-"+r[e[t+10]]+r[e[t+11]]+r[e[t+12]]+r[e[t+13]]+r[e[t+14]]+r[e[t+15]]).toLowerCase()}(a)},o={},a=Object.prototype.hasOwnProperty,h="~";function c(){}function l(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function u(e,t,n,r,i){if("function"!=typeof n)throw TypeError("The listener must be a function");var s=new l(n,r||e,i),o=h?h+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],s]:e._events[o].push(s):(e._events[o]=s,e._eventsCount++),e}function d(e,t){0==--e._eventsCount?e._events=new c:delete e._events[t]}function f(){this._events=new c,this._eventsCount=0}Object.create&&(c.prototype=Object.create(null),new c().__proto__||(h=!1)),f.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)a.call(e,t)&&n.push(h?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},f.prototype.listeners=function(e){var t=h?h+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,s=Array(i);r<i;r++)s[r]=n[r].fn;return s},f.prototype.listenerCount=function(e){var t=h?h+e:e,n=this._events[t];return n?n.fn?1:n.length:0},f.prototype.emit=function(e,t,n,r,i,s){var o=h?h+e:e;if(!this._events[o])return!1;var a,c,l=this._events[o],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,r),!0;case 5:return l.fn.call(l.context,t,n,r,i),!0;case 6:return l.fn.call(l.context,t,n,r,i,s),!0}for(c=1,a=Array(u-1);c<u;c++)a[c-1]=arguments[c];l.fn.apply(l.context,a)}else{var d,f=l.length;for(c=0;c<f;c++)switch(l[c].once&&this.removeListener(e,l[c].fn,void 0,!0),u){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,t);break;case 3:l[c].fn.call(l[c].context,t,n);break;case 4:l[c].fn.call(l[c].context,t,n,r);break;default:if(!a)for(d=1,a=Array(u-1);d<u;d++)a[d-1]=arguments[d];l[c].fn.apply(l[c].context,a)}}return!0},f.prototype.on=function(e,t,n){return u(this,e,t,n,!1)},f.prototype.once=function(e,t,n){return u(this,e,t,n,!0)},f.prototype.removeListener=function(e,t,n,r){var i=h?h+e:e;if(!this._events[i])return this;if(!t)return d(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||r&&!s.once||n&&s.context!==n||d(this,i);else{for(var o=0,a=[],c=s.length;o<c;o++)(s[o].fn!==t||r&&!s[o].once||n&&s[o].context!==n)&&a.push(s[o]);a.length?this._events[i]=1===a.length?a[0]:a:d(this,i)}return this},f.prototype.removeAllListeners=function(e){var t;return e?(t=h?h+e:e,this._events[t]&&d(this,t)):(this._events=new c,this._eventsCount=0),this},f.prototype.off=f.prototype.removeListener,f.prototype.addListener=f.prototype.on,f.prefixed=h,f.EventEmitter=f,o=f;const p={RTCPeerConnection:"undefined"==typeof RTCPeerConnection?null:RTCPeerConnection,RTCSessionDescription:"undefined"==typeof RTCSessionDescription?null:RTCSessionDescription,RTCIceCandidate:"undefined"==typeof RTCIceCandidate?null:RTCIceCandidate};class x extends o.EventEmitter{constructor(e){super(),this.initiator=!1,this.maxChannelMessageSize=16384,this.sdpTransform=w,this.config={iceServers:[]},this.pendingCandidates=[],this.webrtc=p,this.id=e.id||s(),this.channelName=e.channelName||s(),e.channelConfig&&(this.channelConfig=e.channelConfig),e.sdpTransform&&(this.sdpTransform=e.sdpTransform),e.config&&(this.config=e.config),e.offerConfig&&(this.offerConfig=e.offerConfig),e.answerConfig&&(this.answerConfig=e.answerConfig),e.maxChannelMessageSize&&e.maxChannelMessageSize>0&&(this.maxChannelMessageSize=e.maxChannelMessageSize),e.webrtc&&(this.webrtc=e.webrtc)}getId(){return this.id}getConnection(){return this.connection}getChannel(){return this.channel}isReady(){return this.channel&&"open"===this.channel.readyState}isClosed(){return!this.connection||"connected"!==this.connection.connectionState}ready(){return this.isReady()?Promise.resolve():this.waitOnce("connect")}data(){return this.waitOnce("data")}closed(){return this.waitOnce("close")}isInitiator(){return this.initiator}init(){return this.initiator=!0,this.createPeer()}close(){return this.internalClose(!0)}send(e){if(!this.channel)throw Error("Channel not initialized");return this.channel.send(e),this}write(e){if(!this.channel)throw Error("Channel not initialized");return v(this.channel,e,this.maxChannelMessageSize)}writableStream(){var e,t;if(!this.channel)throw Error("Channel not initialized");return e=this.channel,t=this.maxChannelMessageSize,new WritableStream({write(n){v(e,n,t)}})}readableStream(){if(!this.channel)throw Error("Channel not initialized");return function(e){let t=!1,n=!1,r=[],i=[];function s(e){if(i.length){let[t,n]=i.shift();t(e.data)}else r.push(e.data)}e.addEventListener("message",s);let o=()=>{if(!t){for(let[n,r]of(e.removeEventListener("message",s),e.removeEventListener("close",o),t=!0,i))r(Error("Stream closed"));i.length=0,r.length=0}};return e.addEventListener("close",o),new ReadableStream({async pull(e){if(t){n||(n=!0,e.close());return}r.length?e.enqueue(r.shift()):e.enqueue(await new Promise((e,t)=>i.push([e,t])))},cancel:o})}(this.channel)}async signal(e){var t,n;switch(this.connection||await this.createPeer(),console.debug(`${this.id}: received signal message=${e.type}`),e.type){case"renegotiate":return this.negotiate();case"transceiverRequest":{if(!this.initiator)throw Error("Invalid signal state");let t=e.transceiverRequest;if(!t)throw Error("Invalid signal message");return await this.addTransceiverFromKind(t.kind,t.init),this}case"candidate":{if(!this.connection)throw Error("Connection not initialized");let t=e.candidate;if(!t)throw Error("Invalid signal message");let n=new this.webrtc.RTCIceCandidate(t);return null==this.connection.remoteDescription?this.pendingCandidates.push(n):await this.connection.addIceCandidate(n),this}case"answer":case"offer":case"pranswer":case"rollback":{if(!this.connection)throw Error("Connection not initialized");let r=e.sdp;if(!r)throw Error("Invalid signal message");let i=new this.webrtc.RTCSessionDescription({type:e.type,sdp:r});for(let e of(await this.connection.setRemoteDescription(i),this.pendingCandidates))await this.connection.addIceCandidate(e);return this.pendingCandidates.length=0,(null===(n=null===(t=this.connection)||void 0===t?void 0:t.remoteDescription)||void 0===n?void 0:n.type)==="offer"&&await this.createAnswer(),this.emit("negotiated"),console.debug(`${this.id}: set remote sdp`),this}default:throw console.debug(`${this.id}: invalid signal type: ${e}`),Error("Invalid signal message type")}}waitOnce(e){return new Promise(t=>{this.once(e,(...e)=>{switch(e.length){case 0:t(void 0);break;case 1:t(e[0]);break;default:t(e)}})})}addTransceiverFromKind(e,t){if(!this.connection)throw Error("Connection not initialized");if(this.initiator){let n=this.connection.addTransceiver(e,t);return this.emit("transceiver",n),n}return this.internalSignal({type:"transceiverRequest",transceiverRequest:{kind:e,init:t}}),null}addTrack(e){if(!this.connection)throw Error("Connection not initialized");return this.connection.addTrack(e)}removeTrack(e){if(!this.connection)throw Error("Connection not initialized");return this.connection.removeTrack(e),this}internalSignal(e){return this.emit("signal",e),this}async negotiate(){return this.initiator?await this.createOffer():this.internalSignal({type:"renegotiate",renegotiate:!0}),this}async createOffer(){if(!this.connection)throw Error("Connection not initialized");let e=await this.connection.createOffer(this.offerConfig);return e.sdp=this.sdpTransform(e.sdp),await this.connection.setLocalDescription(e),this.internalSignal({type:e.type,sdp:e.sdp}),this}async createAnswer(){if(!this.connection)throw Error("Connection not initialized");let e=await this.connection.createAnswer(this.answerConfig);return e.sdp=this.sdpTransform(e.sdp),await this.connection.setLocalDescription(e),this.internalSignal({type:e.type,sdp:e.sdp}),this}createPeer(){if(this.internalClose(!1),this.connection=new this.webrtc.RTCPeerConnection(this.config),this.connection.addEventListener("negotiationneeded",this.onNegotiationNeeded.bind(this)),this.connection.addEventListener("iceconnectionstatechange",this.onICEConnectionStateChange.bind(this)),this.connection.addEventListener("icegatheringstatechange",this.onICEGatheringStateChange.bind(this)),this.connection.addEventListener("connectionstatechange",this.onConnectionStateChange.bind(this)),this.connection.addEventListener("icecandidate",this.onICECandidate.bind(this)),this.connection.addEventListener("signalingstatechange",this.onSignalingStateChange.bind(this)),this.connection.addEventListener("track",this.onTrackRemote.bind(this)),this.initiator){let e=this.connection.createDataChannel(this.channelName,this.channelConfig);e.addEventListener("open",this.onDataChannelOpen.bind(this)),e.addEventListener("message",this.onDataChannelMessage.bind(this)),e.addEventListener("error",this.onDataChannelError.bind(this)),this.channel=e}else this.connection.addEventListener("datachannel",this.onDataChannel.bind(this));return this}internalClose(e=!0){return this.channel&&(this.channel.close(),this.channel=void 0),this.connection&&(this.connection.close(),this.connection=void 0),e&&this.emit("close"),this}onConnectionStateChange(){if(this.connection)switch(console.debug(`${this.id}: connection state ${this.connection.connectionState}`),this.connection.connectionState){case"failed":case"disconnected":case"closed":this.internalClose(!0)}}onNegotiationNeeded(){if(this.connection)return this.negotiate()}onICEConnectionStateChange(){this.connection&&console.debug(`${this.id}: ice connection state ${this.connection.iceConnectionState}`)}onICEGatheringStateChange(){this.connection&&console.debug(`${this.id}: ice gathering state ${this.connection.iceGatheringState}`)}onSignalingStateChange(){this.connection&&console.debug(`${this.id}: signaling state ${this.connection.signalingState}`)}onICECandidate(e){e.candidate&&this.internalSignal({type:"candidate",candidate:e.candidate})}onTrackRemote(e){this.emit("track",e)}onDataChannel(e){let t=e.channel;this.channel=t,this.channel.onopen=this.onDataChannelOpen.bind(this),this.channel.onmessage=this.onDataChannelMessage.bind(this),this.channel.onerror=this.onDataChannelError.bind(this)}onDataChannelOpen(){console.debug(`${this.id}: data channel open`),this.emit("connect")}onDataChannelMessage(e){this.emit("data",e.data)}onDataChannelError(e){this.emit("error",Error("DataChannel error",{cause:e}))}}function w(e){return e}function v(e,t,n){if("string"==typeof t){if(t.length<n)e.send(t);else{let r=0;for(;r<t.length;){let i=Math.min(n,t.length-r);e.send(t.substring(r,r+i)),r+=i}}}else if(t instanceof Blob){if(t.size<n)e.send(t);else{let r=0;for(;r<t.size;){let i=Math.min(n,t.size-r);e.send(t.slice(r,r+i)),r+=i}}}else{let r;if((r=t instanceof ArrayBuffer?t:t.buffer).byteLength<n)e.send(r);else{let t=0;for(;t<r.byteLength;){let i=Math.min(n,r.byteLength-t);e.send(r.slice(t,t+i)),t+=i}}}}function y(e,t){return e[0]=(0xff000000&t)>>24,e[1]=(0xff0000&t)>>16,e[2]=(65280&t)>>8,e[3]=255&t,e}function g(e){return e[3]|e[2]<<8|e[1]<<16|e[0]<<24}new Uint8Array(1),new Uint8Array(4),new Float32Array(1);const m=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,b=/^[ \t]+(.*[^ \t])/,_=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/,C=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/,E=new TextEncoder,I=new TextDecoder;class k extends Request{constructor(e,t){let n=t?.headers;super(e,t),n&&Object.defineProperty(this,"headers",{value:new Headers(n),writable:!1})}}async function S(e,t={mode:"same-origin",credentials:"include"}){let n=M(e),[r,i]=await A(n),[s,o,a]=await R(n),h=W(n,o,a);return new k(i,{...t,method:r,headers:s,body:h,duplex:"half"})}async function L(e){let t=M(e),[n,r]=await T(t),[i,s,o]=await R(t);return new Response(W(t,s,o),{status:n,statusText:r,headers:i})}async function O(e,t){let n=e.getWriter(),r=!1;try{let[i,s]=t instanceof Request?[t,null]:[null,t];i?await n.write(E.encode(`${i.method} ${i.url} HTTP/1.1\r
`)):await n.write(E.encode(`HTTP/1.1 ${s.status} ${s.statusText}\r
`));let o=new Headers(t.headers);if(t.body){if(i){let e=await $(t.body.getReader());for(let[t,r]of(o.set("Content-Length",`${e.byteLength}`),o.entries()))await n.write(E.encode(`${t}: ${r}\r
`));await n.write(E.encode("\r\n")),await n.write(e)}else{let i=Number.parseInt(o.get("Content-Length")||"0",10),s=o.get("Transfer-Encoding")?.toLowerCase()==="chunked";for(let[e,t]of o.entries())await n.write(E.encode(`${e}: ${t}\r
`));await n.write(E.encode("\r\n")),n.releaseLock(),await W(M(t.body.getReader()),s,i)?.pipeTo(e),r=!0}}else{for(let[e,t]of o.entries())await n.write(E.encode(`${e}: ${t}\r
`));await n.write(E.encode("\r\n"))}}finally{r||(n.releaseLock(),e.close())}}async function A(e){let{done:t,value:n}=await e.readLine();if(t)throw Error("Unexpected end of request");let r=_.exec(n);if(!r)throw Error(`Invalid request line: ${n}`);return[r[1],r[2],+r[3],+r[4]]}async function T(e){let{done:t,value:n}=await e.readLine();if(t)throw Error("Unexpected end of request");let r=C.exec(n);if(!r)throw Error(`Invalid response line: ${n}`);return[+r[3],r[4],+r[1],+r[2]]}async function R(e){let t=new Headers,n=!1,r=0;for(;;){let{done:i,value:s}=await e.readLine();if(i)throw Error("Unexpected end of headers");if(""===s)break;let o=m.exec(s);if(!o)throw Error(`Invalid header line: ${s}`);let a=o[2];for(;;){let e=b.exec(a);if(!e)break;a=e[1]}let h=o[1].toLowerCase();"transfer-encoding"===h&&"chunked"===a.toLowerCase()?n=!0:"content-length"===h&&(r=+a),t.append(o[1],a)}return[t,n,r]}function W(e,t,n){if(!t&&0===n)return null;let r=new TransformStream;return j(e,r.writable,t,n),r.readable}async function j(e,t,n,r){let i=t.getWriter();try{if(n)for(;;){let{done:t,value:n}=await e.readLine();if(t)throw Error("Unexpected end of stream");if(m.exec(n)){await e.readLine();break}let r=Number.parseInt(n,16);if(!r)break;let s=r;for(;s>0;){let{done:t,value:n}=await e.read(r);if(t)throw Error("Unexpected end of stream");s-=n.byteLength,await i.write(n)}await e.readLine()}else{let t=r;for(;t>0;){let{done:n,value:r}=await e.read(t);if(n)throw Error("Unexpected end of stream");t-=r.byteLength,await i.write(r)}}}finally{e.releaseLock(),i.releaseLock(),t.close()}}function M(e,t=4096){let n=new Uint8Array(t),r=0,i=0,s=!1;async function o(t){if(s)return t<i;for(;t>=i;){let{done:t,value:r}=await e.read();if(t){s=!0;break}n=function(e,t,n){if(n.byteLength>=e.byteLength-t){let r=new Uint8Array(2*e.byteLength);return r.set(e),r.set(n,t),r}return e.set(n,t),e}(n,i,r),i+=r.byteLength}return t<i}return{readLine:async function(){let e=r,t=await o(e);for(;t;){if(10===n[e]){let t=13===n[e-1]?e-1:e,i=I.decode(n.slice(r,t));return r=e+1,{done:!1,value:i}}++e>=i&&(t=await o(e))}return{done:!0}},read:async function(e){let t=r+e;await o(t-1);let s=Math.min(i-r,e);if(0===s)return{done:!0};let a=n.slice(r,r+s);return r+=s,{done:!1,value:a}},releaseLock:function(){e.releaseLock()}}}function U(e,t){let n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e),n.set(t,e.byteLength),n}async function $(e){try{let{done:t,value:n}=await e.read();if(t)return new Uint8Array;let r=n;for(;;){let{done:t,value:n}=await e.read();if(t)break;r=U(r,n)}return r}finally{e.releaseLock()}}function N(e,t,n,r){return new(n||(n=Promise))(function(i,s){function o(e){try{h(r.next(e))}catch(e){s(e)}}function a(e){try{h(r.throw(e))}catch(e){s(e)}}function h(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,a)}h((r=r.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;const z={},D={};class P{constructor(e,t){if(e!==z)throw TypeError("Options can only be created with the some or none functions");this._value=t}static some(e){return J(e)}static none(){return V()}static from(e){return null!=e?J(e):V()}static fromJSON(e){return P.from(e)}isNone(){return this._value===D}isSome(){return!this.isNone()}expect(e){if(this.isSome())return this._value;throw Error("function"==typeof e?e():e)}unwrap(){return this.expect("Tried to unwrap value of none Option")}unwrapOr(e){return this.isSome()?this._value:e}unwrapOrElse(e){return this.isSome()?this._value:e()}map(e){return this.isSome()?J(e(this._value)):V()}mapOr(e,t){return this.isSome()?J(e(this._value)):J(t)}mapOrElse(e,t){return this.isSome()?J(e(this._value)):J(t())}flatMap(e){return this.isSome()?e(this._value):V()}flatMapOr(e,t){return this.isSome()?e(this._value):t}flatMapOrElse(e,t){return this.isSome()?e(this._value):t()}and(e){return this.isSome()?e:V()}andThen(e){return this.isSome()?e(this._value):V()}or(e){return this.isNone()?e:this}orElse(e){return this.isNone()?e():this}xor(e){let t=this.isSome(),n=e.isSome();return t&&!n?this:!t&&n?e:V()}filter(e){return this.isSome()&&e(this._value)?this:V()}getOrInsert(e){return this.isNone()&&(this._value=e),this}getOrInsertWith(e){return this.isNone()&&(this._value=e()),this}clear(){return this._value=D,this}take(){if(!this.isSome())return V();{let e=this._value;return this._value=D,J(e)}}from(e){return null!=e?this._value=e:this.clear(),this}replace(e){return this._value=e,this}ifSome(e,t){return this.isSome()?e(this._value):t&&t(),this}ifNone(e,t){return this.isNone()?e():t&&t(this._value),this}toJSON(){return this.unwrapOr(null)}toJS(){return this.unwrapOr(null)}[Symbol.iterator](){return new F(this._value)}}class F{constructor(e){this.value=e}next(){if(this.value===D)return{done:!0,value:void 0};{let e=this.value;return this.value=D,{done:!1,value:e}}}}const J=e=>new P(z,e),V=()=>new P(z,D);class q{constructor(e){this._index=0,this._iter=e}[Symbol.asyncIterator](){return this}iter(){return this}next(){return this._iter.next()}nextWithIndex(){return N(this,void 0,void 0,function*(){let e=yield this._iter.next();return e.done?e:{value:[e.value,this._index++]}})}enumerate(){throw Error("async/AsyncEnumerate was not imported!")}peekable(){throw Error("async/AsyncPeekable was not imported!")}forEach(e){throw Error("async/AsyncForEach was not imported!")}map(e){throw Error("async/AsyncMap was not imported!")}merge(e){throw Error("async/AsyncMerge was not imported!")}concat(e){return this.merge(e)}filter(e){throw Error("async/AsyncFilter was not imported!")}step(e){throw Error("async/AsyncStep was not imported!")}skip(e){throw Error("async/AsyncSkip was not imported!")}take(e){throw Error("async/AsyncTake was not imported!")}toMap(e,t){throw Error("async/AsyncToMap was not imported!")}flatten(e){throw Error("async/AsyncFlatten was not imported!")}unflatten(e){throw Error("async/AsyncUnflatten was not imported!")}reverse(){throw Error("async/AsyncReverse was not imported!")}count(){return this.reduce(0,e=>e+1)}consume(){return N(this,void 0,void 0,function*(){let e=yield this.next();for(;!e.done;)e=yield this.next();return this})}toArray(){return this.reduce([],(e,t)=>(e.push(t),e))}join(e){return N(this,void 0,void 0,function*(){return(yield this.toArray()).join(e)})}indexOf(e){return N(this,void 0,void 0,function*(){let t=yield this.next(),n=0;for(;!t.done;){if(t.value===e)return n;n++,t=yield this.next()}return -1})}findIndex(e){return N(this,void 0,void 0,function*(){let t=yield this.nextWithIndex();for(;!t.done;){let[n,r]=t.value;if(e(n,r))return r;t=yield this.nextWithIndex()}return -1})}find(e){return N(this,void 0,void 0,function*(){let t=yield this.nextWithIndex();for(;!t.done;){let[n,r]=t.value;if(e(n,r))return J(n);t=yield this.nextWithIndex()}return V()})}findAll(e){return this.filter(e)}nth(e=0){return N(this,void 0,void 0,function*(){let t=yield this.next();for(e<0&&(e=0);!t.done;){if(e--<=0)return J(t.value);t=yield this.next()}return V()})}first(){return this.nth(0)}last(){return N(this,void 0,void 0,function*(){let e=yield this.next();for(;!e.done;){let t=yield this.next();if(t.done)return J(e.value);e=t}return V()})}any(e){return N(this,void 0,void 0,function*(){return(yield this.findIndex(e))!==-1})}some(e){return N(this,void 0,void 0,function*(){return this.any(e)})}none(e){return N(this,void 0,void 0,function*(){return(yield this.findIndex(e))===-1})}all(e){return N(this,void 0,void 0,function*(){let t=yield this.nextWithIndex();for(;!t.done;){let[n,r]=t.value;if(!e(n,r))return!1;t=yield this.nextWithIndex()}return!0})}reduce(e,t){return N(this,void 0,void 0,function*(){let n=yield this.next();for(;!n.done;){let r=n.value;e=t(e,r,this._index-1),n=yield this.next()}return e})}}class H{constructor(e){this._index=0,this._iter=e}[Symbol.iterator](){return this}iter(){return this}next(){return this._iter.next()}nextWithIndex(){let e=this._iter.next();return e.done?e:{value:[e.value,this._index++]}}enumerate(){throw Error("Enumerate was not imported!")}peekable(){throw Error("Peekable was not imported!")}forEach(e){throw Error("ForEach was not imported!")}map(e){throw Error("Map was not imported!")}merge(e){throw Error("Merge was not imported!")}concat(e){return this.merge(e)}filter(e){throw Error("Filter was not imported!")}step(e){throw Error("Step was not imported!")}skip(e){throw Error("Skip was not imported!")}take(e){throw Error("Take was not imported!")}toMap(e,t){throw Error("ToMap was not imported!")}flatten(e){throw Error("Flatten was not imported!")}unflatten(e){throw Error("Unflatten was not imported!")}reverse(){throw Error("Reverse was not imported!")}count(){return this.reduce(0,e=>e+1)}consume(){let e=this.next();for(;!e.done;)e=this.next();return this}toArray(){return this.reduce([],(e,t)=>(e.push(t),e))}join(e){return this.toArray().join(e)}indexOf(e){let t=this.next(),n=0;for(;!t.done;){if(t.value===e)return n;n++,t=this.next()}return -1}findIndex(e){let t=this.nextWithIndex();for(;!t.done;){let[n,r]=t.value;if(e(n,r))return r;t=this.nextWithIndex()}return -1}find(e){let t=this.nextWithIndex();for(;!t.done;){let[n,r]=t.value;if(e(n,r))return J(n);t=this.nextWithIndex()}return V()}findAll(e){return this.filter(e)}nth(e=0){let t=this.next();for(e<0&&(e=0);!t.done;){if(e--<=0)return J(t.value);t=this.next()}return V()}first(){return this.nth(0)}last(){let e=this.next();for(;!e.done;){let t=this.next();if(t.done)return J(e.value);e=t}return V()}any(e){return -1!==this.findIndex(e)}some(e){return this.any(e)}none(e){return -1===this.findIndex(e)}all(e){let t=this.nextWithIndex();for(;!t.done;){let[n,r]=t.value;if(!e(n,r))return!1;t=this.nextWithIndex()}return!0}reduce(e,t){let n=this.next();for(;!n.done;){let r=n.value;e=t(e,r,this._index-1),n=this.next()}return e}}class B extends H{constructor(e){super(e)}next(){let e=super.nextWithIndex();return e.done?e:{value:Q(e.value)}}}function Q(e){let t=e[0];return e[0]=e[1],e[1]=t,e}H.prototype.enumerate=function(){return new B(this)};class G extends q{constructor(e){super(e)}next(){let e=Object.create(null,{nextWithIndex:{get:()=>super.nextWithIndex}});return N(this,void 0,void 0,function*(){let t=yield e.nextWithIndex.call(this);return t.done?t:{value:Q(t.value)}})}}q.prototype.enumerate=function(){return new G(this)};class K extends q{constructor(e,t){super(e),this._fn=t}next(){let e=Object.create(null,{nextWithIndex:{get:()=>super.nextWithIndex}});return N(this,void 0,void 0,function*(){let t=yield e.nextWithIndex.call(this);for(;!t.done;){let[n,r]=t.value;if(this._fn(n,r))return{done:!1,value:n};t=yield e.nextWithIndex.call(this)}return{done:!0,value:void 0}})}}q.prototype.filter=function(e){return new K(this,e)};class X extends q{constructor(e,t){super(e),this._fn=([e,n])=>(t(e,n),e)}next(){let e=Object.create(null,{nextWithIndex:{get:()=>super.nextWithIndex}});return N(this,void 0,void 0,function*(){let t=yield e.nextWithIndex.call(this);return t.done?t:{done:!1,value:this._fn(t.value)}})}}q.prototype.forEach=function(e){return new X(this,e)};class Y extends q{constructor(e,t){super(e),this._fn=t}next(){let e=Object.create(null,{nextWithIndex:{get:()=>super.nextWithIndex}});return N(this,void 0,void 0,function*(){let t=yield e.nextWithIndex.call(this);return t.done?t:{done:!1,value:this._fn(t.value[0],t.value[1])}})}}q.prototype.map=function(e){return new Y(this,e)};class Z extends q{constructor(e,t){super(e),this._other=t}next(){let e=Object.create(null,{next:{get:()=>super.next}});return N(this,void 0,void 0,function*(){let t=yield e.next.call(this);return t.done?this._other.next():t})}}q.prototype.merge=function(e){return new Z(this,e)};class ee extends q{constructor(){super(...arguments),this.peeked=[]}unpeekAll(){return this.peeked.length=0,this}unpeek(){return this.peeked.length>0?J(this.peeked.shift()):V()}peek(e=0){let t=Object.create(null,{next:{get:()=>super.next}});return N(this,void 0,void 0,function*(){if(e<this.peeked.length)return J(this.peeked[e]);{let n=this.peeked.length-e-1,r=yield t.next.call(this);for(;!r.done&&(this.peeked.push(r.value),!(--n<=0));)r=yield t.next.call(this);return r.done?V():J(r.value)}})}next(){let e=Object.create(null,{next:{get:()=>super.next}});return N(this,void 0,void 0,function*(){let t=this.unpeek();if(t.isSome())return{done:!1,value:t.unwrap()};let n=yield e.next.call(this);return n.done?n:{done:!1,value:n.value}})}}q.prototype.peekable=function(){return new ee(this)};class et extends q{constructor(e){super(e),this.index=0,this.reversed=!1,this.values=[]}next(){let e=Object.create(null,{next:{get:()=>super.next}});return N(this,void 0,void 0,function*(){if(!this.reversed){let t=yield e.next.call(this);for(;!t.done;)this.values.push(t),t=yield e.next.call(this);this.reversed=!0,this.index=this.values.length}return 0===this.index?{done:!0,value:void 0}:(this.index-=1,this.values[this.index])})}}q.prototype.reverse=function(){return new et(this)};class en extends q{constructor(e,t){super(e),this._skipped=0,this._skip=(t<=0?0:t)|0}next(){let e=Object.create(null,{next:{get:()=>super.next}});return N(this,void 0,void 0,function*(){let t=yield e.next.call(this);for(;!t.done;){if(!(this._skipped<=this._skip))return t;this._skipped+=1,t=yield e.next.call(this)}return{done:!0,value:void 0}})}}q.prototype.skip=function(e){return new en(this,e)};class er extends q{constructor(e,t){super(e),this._stepped=0,this._step=t<=0?1:0|t}next(){let e=Object.create(null,{next:{get:()=>super.next}});return N(this,void 0,void 0,function*(){let t=yield e.next.call(this);for(;!t.done;)if(!(this._stepped<this._step))return this._stepped=0,t;else this._stepped+=1,t=yield e.next.call(this);return{done:!0,value:void 0}})}}q.prototype.step=function(e){return new er(this,e)};class ei extends q{constructor(e,t){super(e),this._taken=0,this._count=(t<=0?0:t)|0}next(){let e=Object.create(null,{next:{get:()=>super.next}});return N(this,void 0,void 0,function*(){return this._taken<this._count?(this._taken+=1,e.next.call(this)):{done:!0,value:void 0}})}}q.prototype.take=function(e){return new ei(this,e)};const es=e=>e,eo=e=>e;class ea extends H{constructor(e,t=es,n=eo){super(e),this._map=([e,r])=>[t(e,r),n(e,r)]}toObject(){return this.reduce({},(e,t)=>(e[t[0]]=t[1],e))}next(){let e=super.nextWithIndex();return e.done?e:{done:!1,value:this._map(e.value)}}}H.prototype.toMap=function(e,t){return new ea(this,e,t)};class eh extends q{constructor(e,t=es,n=eo){super(e),this._map=([e,r])=>[t(e,r),n(e,r)]}toObject(){return this.reduce({},(e,t)=>(e[t[0]]=t[1],e))}next(){let e=Object.create(null,{nextWithIndex:{get:()=>super.nextWithIndex}});return N(this,void 0,void 0,function*(){let t=yield e.nextWithIndex.call(this);return t.done?t:{done:!1,value:this._map(t.value)}})}}q.prototype.toMap=function(e,t){return new eh(this,e,t)};class ec extends q{constructor(e,t){super(e),this._fn=t}next(){return N(this,void 0,void 0,function*(){return this._fn(this._iter)})}}q.prototype.unflatten=function(e){return new ec(this,e)};class el extends q{constructor(e,t=1){super(e),this._current=void 0,this._depth=t}next(){return N(this,void 0,void 0,function*(){if(void 0!==this._current){let e=yield this._current.next();if(!e.done)return e;this._current=void 0}return this._nextRecur()})}_nextRecur(){let e=Object.create(null,{next:{get:()=>super.next}});return N(this,void 0,void 0,function*(){let t=yield e.next.call(this);if(t.done||!(this._depth>0))return t;{let e=(function e(t){return null==t?e([]):"function"==typeof t[Symbol.asyncIterator]?new q(t[Symbol.asyncIterator]()):"function"==typeof t[Symbol.iterator]?new q(t[Symbol.iterator]()):"function"==typeof t.next?t instanceof q?t:new q(t):"object"==typeof t?e(Object.entries(t)):e([t])})(t.value).flatten(this._depth-1),n=yield e.next();return n.done?this._nextRecur():(this._current=e,n)}})}}q.prototype.flatten=function(e=1){return new el(this,e)};class eu extends H{constructor(e,t){super(e),this._fn=t}next(){let e=super.nextWithIndex();for(;!e.done;){let[t,n]=e.value;if(this._fn(t,n))return{done:!1,value:t};e=super.nextWithIndex()}return{done:!0,value:void 0}}}H.prototype.filter=function(e){return new eu(this,e)};class ed extends H{constructor(e,t){super(e),this._fn=([e,n])=>(t(e,n),e)}next(){let e=super.nextWithIndex();return e.done?e:{done:!1,value:this._fn(e.value)}}}H.prototype.forEach=function(e){return new ed(this,e)};class ef extends H{constructor(e,t){super(e),this._fn=t}next(){let e=super.nextWithIndex();if(e.done)return e;{let[t,n]=e.value;return{done:!1,value:this._fn(t,n)}}}}H.prototype.map=function(e){return new ef(this,e)};class ep extends H{constructor(e,t){super(e),this._other=t}next(){let e=super.next();return e.done?this._other.next():e}}H.prototype.merge=function(e){return new ep(this,e)};class ex extends H{constructor(){super(...arguments),this.peeked=[]}unpeekAll(){return this.peeked.length=0,this}unpeek(){return this.peeked.length>0?J(this.peeked.shift()):V()}peek(e=0){if(e<this.peeked.length)return J(this.peeked[e]);{let t=this.peeked.length-e-1,n=super.next();for(;!n.done&&(this.peeked.push(n.value),!(--t<=0));)n=super.next();return n.done?V():J(n.value)}}next(){let e=this.unpeek();if(e.isSome())return{done:!1,value:e.unwrap()};let t=super.next();return t.done?t:{done:!1,value:t.value}}}H.prototype.peekable=function(){return new ex(this)};class ew extends H{constructor(e){super(e),this.index=0,this.reversed=!1,this.values=[]}next(){if(!this.reversed){let e=super.next();for(;!e.done;)this.values.push(e),e=super.next();this.reversed=!0,this.index=this.values.length}return 0===this.index?{done:!0,value:void 0}:(this.index-=1,this.values[this.index])}}H.prototype.reverse=function(){return new ew(this)};class ev extends H{constructor(e,t){super(e),this._skipped=0,this._skip=(t<=0?0:t)|0}next(){let e=super.next();for(;!e.done;){if(!(this._skipped<=this._skip))return e;this._skipped+=1,e=super.next()}return{done:!0,value:void 0}}}H.prototype.skip=function(e){return new ev(this,e)};class ey extends H{constructor(e,t){super(e),this._stepped=0,this._step=t<=0?1:0|t}next(){let e=super.next();for(;!e.done;)if(!(this._stepped<this._step))return this._stepped=0,e;else this._stepped+=1,e=super.next();return{done:!0,value:void 0}}}H.prototype.step=function(e){return new ey(this,e)};class eg extends H{constructor(e,t){super(e),this._taken=0,this._count=(t<=0?0:t)|0}next(){return this._taken<this._count?(this._taken+=1,super.next()):{done:!0,value:void 0}}}H.prototype.take=function(e){return new eg(this,e)};class em extends H{constructor(e,t){super(e),this._fn=t}next(){return this._fn(this._iter)}}H.prototype.unflatten=function(e){return new em(this,e)};class eb extends H{constructor(e,t=1){super(e),this._current=void 0,this._depth=t}next(){if(void 0!==this._current){let e=this._current.next();if(!e.done)return e;this._current=void 0}return this._nextRecur()}_nextRecur(){let e=super.next();if(e.done||!(this._depth>0))return e;{let t=(function e(t){return null==t?e([]):"function"==typeof t[Symbol.iterator]?new H(t[Symbol.iterator]()):"function"==typeof t.next?t instanceof H?t:new H(t):"object"==typeof t?e(Object.entries(t)):e([t])})(e.value).flatten(this._depth-1),n=t.next();return n.done?this._nextRecur():(this._current=t,n)}}}H.prototype.flatten=function(e=1){return new eb(this,e)};class e_ extends H{constructor(e){super(e),this.rng=e}iter(){return new H(this)}next(){return{done:!1,value:this.rng.nextFloat()}}}class eC extends H{constructor(e,t=0,n=1){super(e),this.rng=e,this.min=t,this.max=n}iter(){return new H(this)}nextFloat(){return this.rng.nextFloatInRange(this.min,this.max)}next(){return{done:!1,value:this.nextFloat()}}}class eE extends H{constructor(e,t=0,n=0x7fffffff){super(e),this.rng=e,this.min=0|t,this.max=0|n}iter(){return new H(this)}nextInt(){return this.rng.nextIntInRange(this.min,this.max)}next(){return{done:!1,value:this.nextInt()}}}const eI=new Uint8Array(4);class ek{nextFloat(){return this.nextInt()/0x7fffffff}nextFloatInRange(e=0,t=1){return e+this.nextFloat()*(t-e)}nextIntInRange(e=0,t=0x7fffffff){return Math.round(this.nextFloatInRange(e,t))}shuffle(e){let t=e.length;for(let n=0;n<t;n++){let r=n+this.nextIntInRange(0,t-n-1),i=e[n];e[n]=e[r],e[r]=i}return e}fromArray(e){return e.length?J(e[this.nextIntInRange(0,e.length-1)]):V()}keyFromObject(e){return this.fromArray(Object.keys(e))}valueFromObject(e){return this.fromArray(Object.values(e))}fillBytes(e){for(let t=0,n=e.length;t<n;t++){let n=t%4;0===n&&y(eI,this.nextInt()),e[t]=eI[n]}return e}[Symbol.iterator](){return this}iter(){return new H(this)}next(){return{done:!1,value:this.nextInt()}}float(){return new e_(this)}uniformFloat(e=0,t=1){return new eC(this,e,t)}uniformInt(e=0,t=0x7fffffff){return new eE(this,e,t)}}const eS="undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues,eL=new Uint32Array(1),eO=new Uint8Array(4),eA=eS?()=>crypto.getRandomValues(eL)[0]%0x7fffffff:()=>0x7fffffff*Math.random()|0,eT=eS?e=>crypto.getRandomValues(Array.isArray(e)?new Uint8Array(e):e):e=>{for(let t=0,n=e.length;t<n;t++){let n=t%4;0===n&&y(eO,eA()),e[t]=eO[n]}return e};class eR extends ek{constructor(e=0x193a6754){super(),this.seed=e}setSeed(e=0x193a6754){return this.seed=e,this}nextInt(){return this.seed=0|Math.imul(48271,this.seed),0x7fffffff&this.seed}}const eW=new eR;class ej extends ek{constructor(e,t,n,r){super(),this.x=0x193a6754,this.y=0xa8a7d469,this.z=0x97830e05,this.w=0x113ba7bb,this.set(e,t,n,r)}static fromSeed(e){return new ej().setSeed(e)}setSeed(e){let t=eW.setSeed(e);return this.set(t.nextInt(),t.nextInt(),t.nextInt(),t.nextInt())}set(e=0x193a6754,t=0xa8a7d469,n=0x97830e05,r=0x113ba7bb){return this.x=0|e,this.y=0|t,this.z=0|n,this.w=0|r,this}nextInt(){let e=this.x,t=e^e<<11;this.x=this.y,this.y=this.z,this.z=this.w;let n=this.w;return this.w=n^n>>19^(t^t>>8),this.w}}function eM(){return 0x7fffffff*Math.random()|0}function eU(e,t,n){return new WritableStream({write(r){!function(e,t,n){if(t.byteLength<n)e.send(t);else{let r=0;for(;r<t.byteLength;){let i=Math.min(n,t.byteLength-r);e.send(t.slice(r,r+i)),r+=i}}}(e,U(t,r),n)}})}function e$(e,t=4096){let n=new Uint8Array(t),r=0,i=e.getWriter();async function s(){r>0&&(await i.write(n.slice(0,r)),r=0)}return new WritableStream({write:async function(e){let i=0;for(;i<e.byteLength;){r>=t&&await s();let o=Math.min(t-r,e.byteLength-i);n.set(e.slice(i,i+o),r),r+=o,i+=o}},async close(){await s(),await i.close()}})}async function eN(e){let t={"Content-Type":"application/json"};"server"===e&&(t.Authorization="Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpc3MiOiJQMlAiLCJpYXQiOjE3MTM3Nzk2MjksImV4cCI6bnVsbCwiYXVkIjoiUDJQIiwic3ViIjoid2VicnRjLWV4YW1wbGUifQ.HNF2HiiU2MzW_2uVFAh8IvRcbw6QU3Eerv91dvp164A");let n=await fetch(`https://p2p.aicacia.com/${e}`,{method:"POST",headers:t,credentials:"same-origin",mode:"cors",body:JSON.stringify({id:"some-globally-unique-id",password:"password"})});if(n.status>=400)throw Error("failed to authenticate");return await n.text()}async function ez(){let e={},t=await eN("server"),n=new WebSocket(`wss://p2p.aicacia.com/server/websocket?token=${t}`);n.addEventListener("open",()=>{n.addEventListener("message",async t=>{let r=JSON.parse(t.data);switch(r.type){case"join":{let t=r.from,i=new x({channelConfig:{ordered:!0}});i.on("error",e=>console.log("error",e)),i.on("signal",e=>{n.send(JSON.stringify({to:t,payload:e}))}),i.on("connect",()=>{!function(e,t){let n=new Map;async function r(n,r){let i=await S(r.stream.readable.getReader()),s=await t(i),o=e$(eU(e,y(new Uint8Array(4),n),16384));await O(o,s)}async function i(e,t){let i=n.get(e);i||(i=function(){let e=new TransformStream;return{stream:e,writer:e.writable.getWriter()}}(),n.set(e,i),r(e,i)),await i.writer.write(t)}async function s(e){let t=new Uint8Array(e.data),n=g(t);await i(n,t.slice(4))}e.addEventListener("message",s),()=>{e.removeEventListener("message",s)}}(i.getChannel(),async e=>new Response(e.body,{status:200,headers:e.headers}))}),i.on("close",()=>{delete e[t]}),e[t]=i;break}case"leave":console.log(`leave ${r.from}`);break;case"message":e[r.from].signal(r.payload)}})})}async function eD(){let e=await eN("client"),t=new WebSocket(`wss://p2p.aicacia.com/client/websocket?token=${e}&payload=${encodeURIComponent(JSON.stringify({name:"test"}))}`);t.addEventListener("open",async()=>{let e=new x({channelConfig:{ordered:!0}});t.addEventListener("message",t=>{e.signal(JSON.parse(t.data))}),e.on("error",e=>console.log("error",e)),e.on("signal",e=>{t.send(JSON.stringify(e))}),e.on("connect",()=>{window.webrtcFetch=function(e){let t=new Map;async function n(e,n){let r=t.get(e);if(!r)throw Error(`No connection found for id: ${e}`);await r.writer.write(n)}async function r(e){let t=new Uint8Array(e.data),r=g(t);await n(r,t.slice(4))}e.addEventListener("message",r);let i=(n,r)=>new Promise((i,s)=>{let o=new k(n,r),a=function(){let e=eM();for(;t.has(e);)e=eM();let n=y(new Uint8Array(4),e),r=new TransformStream,i={idBytes:n,stream:r,writer:r.writable.getWriter()};return t.set(e,i),i}();O(e$(eU(e,a.idBytes,16384)),o).then(()=>L(a.stream.readable.getReader()).then(i)).catch(s)});return i.destroy=()=>e.removeEventListener("message",r),i}(e.getChannel())}),await e.init()})}async function eP(){new URL(window.location.href).searchParams.has("server")?await ez():await eD()}new eR,new ej,new class extends ek{nextInt(){return eA()}fillBytes(e){return eT(e)}},"complete"===document.readyState?eP():window.addEventListener("load",eP);
//# sourceMappingURL=index.9c0ffa27.js.map
